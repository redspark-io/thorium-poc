# Thorium Reader v1.4.0

## Summary

Version `1.4.0` was released on **25 July 2020**.

This release includes the following (notable) new features, improvements and bug fixes:

* Microsoft Windows: fixed a pagination / scrolling random DPI bug, which was preventing turning pages, in the middle or at the end of documents
* Support for EPUB3 FXL Fixed Layout two-page spreads
* Support for EPUB3 Media Overlays and TTS readaloud (both with optional clean overlay view / caption mode), with same keyboard shortcuts as audiobooks
* Localisation: new Japanese user interface translation, fixed Spanish labels (missing and existing), corrected English typos
* In preparation for linking to annotations and search results, navigator now supports DOM Range scroll-into-view (paginated and scroll views), which allows sub-element referencing (for when HTML text spans across CSS columns or scrolling viewport boundaries)
* Development: added fast compiler option, skip Typescript type checking (transpile only)
* Production builds continue to use LevelDown database for the CouchDB adapter, but automated CI and developer builds now use SQLite3 instead of the obsolete JsonDown store which was slow and buggy (uncontrolled file size growth)
* LCP/LSD "return" and "renew" errors now trigger a toast notification to inform the user, friendlier passphrase dialog error reporting, and fixed clipboard copy right
* Audiobooks: no cover was causing an internal crash, support for float values in duration time syntax with iso8601 format
* Improved fullscreen UI layout
* LCP or OPDS download without Content Type attribute in Link, now fallback to HTTP response headers (content-type/disposition)

(previous [v1.3.0 changelog](./CHANGELOG-v1.3.0.md))

## Full Change Log

Git commit diff since `v1.3.0`:
https://github.com/edrlab/thorium-reader/compare/v1.3.0...v1.4.0

=> **69** GitHub Pull Requests or high-level Git commits.

* [(_)](https://github.com/edrlab/thorium-reader/commit/3e1ecb6b167828efcbf5f6fc20ca79fa585ea265) __chore(NPM):__ package updates, including navigator with sub-element (DOM Range) linking for annotations and search results (scroll-into-view of text range inside large paragraph spanning CSS columns of scrolling viewport)
* [(_)](https://github.com/edrlab/thorium-reader/commit/96a561edecc10eabcdecc4f3a21d023e9d9ccb4b) __fix:__ TTS readaloud, R2 navigator improved, now character-level scroll-into-view (during word highlighting), and handling of odd number of pages in two-page spread (shifted CSS column) Fixes [#1079](https://github.com/edrlab/thorium-reader/issues/1079) Fixes [#1108](https://github.com/edrlab/thorium-reader/issues/1108)
* [(_)](https://github.com/edrlab/thorium-reader/commit/6862e38ef74f6c651c5b5ee19efdde39c108b6f8) __fix:__ Audiobooks keyboard shortcuts (same as EPUB3 MediaOverlays and TTS readaloud), Fixes [#1107](https://github.com/edrlab/thorium-reader/issues/1107)
* [(_)](https://github.com/edrlab/thorium-reader/commit/4882c83330c800becf5e9950af6873b50e9236e2) __fix:__ EPUB3 Media Overlays and TTS readaloud playback state across page turns, added keyboard shortcuts (Fixes [#1069](https://github.com/edrlab/thorium-reader/issues/1069) )
* [(_)](https://github.com/edrlab/thorium-reader/commit/2772cb8ea06306b3a17aed273add756af9b78017) __chore(NPM):__ R2 navigator package with improved Windows CSS pixel edge case solving, see issue [#1015](https://github.com/edrlab/thorium-reader/issues/1015)
* [(_)](https://github.com/edrlab/thorium-reader/commit/81b0058abc90134cfa0d0ccccf10cdc8057b1ab3) __chore(NPM):__ package lock file refresh
* [(_)](https://github.com/edrlab/thorium-reader/commit/d701dc0d5b8790dfa34bae7d5ddccd538d45f5c1) __chore(NPM):__ R2 package updates, including navigator which should address issue [#1015](https://github.com/edrlab/thorium-reader/issues/1015), to be tested further in the wild
* [(_)](https://github.com/edrlab/thorium-reader/commit/145db9a72f61d3fb81a9281b60832d83e42b4a0c) __chore(NPM):__ package updates (minor)
* [(_)](https://github.com/edrlab/thorium-reader/commit/f66c63e093a42b143aa348bd9b7f2115ad59ee1f) __chore(NPM):__ package updates
* [(_)](https://github.com/edrlab/thorium-reader/commit/b547d3a7f7e6461b76901f35de1ae48e4e8ca6c2) __chore(NPM):__ package updates
* [(_)](https://github.com/edrlab/thorium-reader/commit/131c27ad47f26f815777658f6b4d5770bae0e768) __fix(l10n):__ English those vs. these (PR [#1103](https://github.com/edrlab/thorium-reader/pull/1103))
* [(_)](https://github.com/edrlab/thorium-reader/commit/fe730b6ff3c378d6a56f404e4669b87926f29958) __chore(NPM):__ package updates, including latest TypeScript WebPack plugin (compiler with type checking), see issue [#1097](https://github.com/edrlab/thorium-reader/issues/1097)
* [(_)](https://github.com/edrlab/thorium-reader/commit/b96b32996bff5a142629c8d8ae600969608cec26) __fix(lint):__ minor line break missing error
* [(_)](https://github.com/edrlab/thorium-reader/commit/c80f9b420d42899386344c7db3363b97a1f98f76) __feat(l10n):__ Japanese translation (original PR [#1034](https://github.com/edrlab/thorium-reader/pull/1034) PR [#1093](https://github.com/edrlab/thorium-reader/pull/1093))
* [(_)](https://github.com/edrlab/thorium-reader/commit/f8b16a0b5472affdad4cdb324913f0c549b9684f) __fix:__ CouchDB database adapter (LevelDown / SQLite) is compacted when app exits, to remove unnecessary snapshots (PR [#1094](https://github.com/edrlab/thorium-reader/pull/1094))
* [(_)](https://github.com/edrlab/thorium-reader/commit/6912519813212f2d2e8ef9c99070d7a8515fb881) __feat(dev):__ faster WebPack dev builds with TypeScript transpile only (skip compiler type checks with "export SKIP_CHECK_TYPESCRIPT=1" and "npm run start:dev"), ensures remote-redux-devtools is exluded from production build (Fixes [#1098](https://github.com/edrlab/thorium-reader/issues/1098) Fixes [#1097](https://github.com/edrlab/thorium-reader/issues/1097))
* [(_)](https://github.com/edrlab/thorium-reader/commit/a372e6a38e2dff65427934a97c960d8d00ea385d) __fix:__ LCP/LSD "return" error now triggers a toast notification so that user is informed (follows PR [#1096](https://github.com/edrlab/thorium-reader/pull/1096) related to issue [#1095](https://github.com/edrlab/thorium-reader/issues/1095))
* [(_)](https://github.com/edrlab/thorium-reader/commit/23d98ddaf76d4abc49690c1ffc0e0241d6f15994) __fix:__ LCP/LSD "renew" error now triggers a toast notification so that user is informed (PR [#1096](https://github.com/edrlab/thorium-reader/pull/1096) Fixes [#1095](https://github.com/edrlab/thorium-reader/issues/1095))
* [(_)](https://github.com/edrlab/thorium-reader/commit/5c7072e7d8a702b2f49d463ae50903ba6ef23e33) __fix:__ on MacOS, CMD+Q did not cause the application to exit when no library window was shown, and added a menu item to make the library re-appear after close (PR [#1092](https://github.com/edrlab/thorium-reader/pull/1092) Fixes [#1087](https://github.com/edrlab/thorium-reader/issues/1087))
* [(_)](https://github.com/edrlab/thorium-reader/commit/7f2d2b08de644e13a723ca2e58778ea66bca0a71) __fix:__ user reader settings automatically saved only in non-session / default mode (PR [#1090](https://github.com/edrlab/thorium-reader/pull/1090) Fixes [#1085](https://github.com/edrlab/thorium-reader/issues/1085))
* [(_)](https://github.com/edrlab/thorium-reader/commit/72d6bd12e560b7771da6e6f3ac509c060f8fa175) __fix(l10n):__ Spanish translation, added missing labels, corrected existing ones (PR [#1074](https://github.com/edrlab/thorium-reader/pull/1074))
* [(_)](https://github.com/edrlab/thorium-reader/commit/233283ed85d3f3f120cabee58e6200265d88a365) __fix:__ LCP passphrase dialog wasa acompanied by confusing red toast notification to announce load failure (Fixes [#1084](https://github.com/edrlab/thorium-reader/issues/1084) PR [#1089](https://github.com/edrlab/thorium-reader/pull/1089))
* [(_)](https://github.com/edrlab/thorium-reader/commit/82fc65f4657e5100c89554d765b9e53ce9825b98) __fix(dev):__ SQLite3 native lib binary preserve for ReduxDevToolCLI
* [(_)](https://github.com/edrlab/thorium-reader/commit/0c4539123fa12dac35a1357926ac631ef933710f) __chore(NPM):__ package update - navigator (audiobook no-cover fix)
* [(_)](https://github.com/edrlab/thorium-reader/commit/07269237817ac7eed8be374fc506697add81ff33) __hotfix:__ SQLite3 needs its PouchDB adapter declared as dependency in Electron Builder package.json
* [(_)](https://github.com/edrlab/thorium-reader/commit/6d95e92b374942b4137b2ac980b4f94a4c4f7872) __hotfix:__ CI build is broken, probably "externals" for main process bundle (must exclude SQLite3 and the PouchDB adapter, just like with LevelDown)
* [(_)](https://github.com/edrlab/thorium-reader/commit/fe37032b03d3cb11d232f220fe3279d616dacbfa) __fix:__ removal of JsonDown, replaced with SQLite native NodeJS module, should fix [#1072](https://github.com/edrlab/thorium-reader/issues/1072) (needs CI testing via Travis and Appveyor), caveat: resets application DB and publications folder
* [(_)](https://github.com/edrlab/thorium-reader/commit/e665456558bb7163ab840bd4d8861a8f53f4d775) __fix:__ accessible label for "detach window" icon button in reader window, now "show library" (Fixes [#964](https://github.com/edrlab/thorium-reader/issues/964) PR [#1078](https://github.com/edrlab/thorium-reader/pull/1078))
* [(_)](https://github.com/edrlab/thorium-reader/commit/755fdcea049b3a62f932bd19dbdb676b4fd96ba3) __fix(regression):__ reader display settings now automatically saved when changed (thus apply to other publications), this also fixes MathJax. Caveat: when "session" mode is enabled, sets default for all newly-opened publications, which isn't necessarily the desired behaviour (Fixes [#1065](https://github.com/edrlab/thorium-reader/issues/1065) Fixes [#1082](https://github.com/edrlab/thorium-reader/issues/1082) )
* [(_)](https://github.com/edrlab/thorium-reader/commit/4a1abf87bb23c3f73f551778dd8b94f5b2341fdb) __fix(workaround):__ HTTPS with expired certificate in the chain now accepted, only in development mode (not production) (Fixes [#1075](https://github.com/edrlab/thorium-reader/issues/1075) Fixes [#1083](https://github.com/edrlab/thorium-reader/issues/1083) Supersedes PR [#1077](https://github.com/edrlab/thorium-reader/pull/1077) )
* [(_)](https://github.com/edrlab/thorium-reader/commit/39c31d6767e88b0d30edfd12311e29090d931f93) __chore(NPM):__ package updates, including R2 navigator which includes a workaround for an Electron regression bug (HTTP headers passthrough)
* [(_)](https://github.com/edrlab/thorium-reader/commit/10bd3b95c984b087e6c50b06e919d715cadec031) __fix(TTS):__ updated navigator component which now supports in-document word-by-word highlighting and sentence-level granular navigation, clean view remains available as an alternative render mode for TTS readaloud.
* [(_)](https://github.com/edrlab/thorium-reader/commit/694b9c63f22db039a1af055b637ea75d2b76ad99) __fix:__ Electron window dimensions calculations, x/y coordinates (Fixes [#1066](https://github.com/edrlab/thorium-reader/issues/1066) )
* [(_)](https://github.com/edrlab/thorium-reader/commit/a4816b1857214a253eed9479fef90de8dd15cf6c) __fix:__ some publication resources were not loading because of their name (navigator bug)
* [(_)](https://github.com/edrlab/thorium-reader/commit/dfbd5ef9241774611481a1ee09239020868e7dc8) __fix:__ ReadiumCSS / reader state was corrupted (PR [#1064](https://github.com/edrlab/thorium-reader/pull/1064) follows PR [#1058](https://github.com/edrlab/thorium-reader/pull/1058) Fixes [#1062](https://github.com/edrlab/thorium-reader/issues/1062))
* [(_)](https://github.com/edrlab/thorium-reader/commit/7ebc3a8e97b2d11137225d866ee359d3749538e9) __hotfix:__ previous commit introduced a possible unwanted x/y coordinate offset for library/reader windows
* [(_)](https://github.com/edrlab/thorium-reader/commit/c1d32cb74e56d413cc5edda430e6c96ab3d12496) __fix:__ reader back arrow icon button was crashing in some cases (bad x/y screen oordinates) (Fixes [#1061](https://github.com/edrlab/thorium-reader/issues/1061) Supersedes PR [#1063](https://github.com/edrlab/thorium-reader/pull/1063) )
* [(_)](https://github.com/edrlab/thorium-reader/commit/3ae023d80d466e51eba37f3489798c38c969466c) __feat:__ NPM package updates, including R2 navigator with new "caption" mode for EPUB3 Media Overlays
* [(_)](https://github.com/edrlab/thorium-reader/commit/4188e75fabd2fbe967af483316bc930ce9b82044) __fix:__ regression, incorrect publication ID, broken reading list (PR [#1060](https://github.com/edrlab/thorium-reader/pull/1060))
* [(_)](https://github.com/edrlab/thorium-reader/commit/a749224ec247575f9f8c7e8f4249f0197d6ef474) __fix(dev):__ preload reader state instead of api request (PR [#1059](https://github.com/edrlab/thorium-reader/pull/1059))
* [(_)](https://github.com/edrlab/thorium-reader/commit/2a832436006a237487308960be96275d01a3651a) __fix:__ persist the partial reader Redux state (PR [#1058](https://github.com/edrlab/thorium-reader/pull/1058))
* [(_)](https://github.com/edrlab/thorium-reader/commit/1217c78a4c3573a1a810d43b9e59644d00f8d00f) __(pierre/develop) chore(CI):__ TravisCI deploy script with new edrlab/thorium-reader GitHub repository (was edrlab/thorium-reader)
* [(_)](https://github.com/edrlab/thorium-reader/commit/579c74389fa6fa011bc1c36e570d9b794a8d69d4) __feat:__ (via navigator component) EPUB FXL Fixed Layout two-page spreads, with support for Media Overlays, selection/highlights, reading location/bookmarks per active/focused page (still at element level) (Fixes [#1040](https://github.com/edrlab/thorium-reader/issues/1040))
* [(_)](https://github.com/edrlab/thorium-reader/commit/9288617a0be3cfde609404cc66eccf2af484a0c2) __chore(NPM):__ package updates, including R2 navigator which includes a Media Overlays skippability fix (epub:type semantics)
* [(_)](https://github.com/edrlab/thorium-reader/commit/3b8ebdf82536d4888288c2827b94c2853763fdb0) __feat:__ EPUB3 Media Overlays, internally W3C Sync Media format in Readium Web Pub Manifest (PR [#1052](https://github.com/edrlab/thorium-reader/pull/1052) Fixes [#939](https://github.com/edrlab/thorium-reader/issues/939) Fixes [#1051](https://github.com/edrlab/thorium-reader/issues/1051))
* [(_)](https://github.com/edrlab/thorium-reader/commit/44822a248ded82698da63878e8c52f42e109d45e) __fix(LCP):__ clipboard copy right
* [(_)](https://github.com/edrlab/thorium-reader/commit/42fa335948251475361d0f27150de60c222e8880) __fix:__ safeguard for undefined browserWin in sync middleware (PR [#1048](https://github.com/edrlab/thorium-reader/pull/1048))
* [(_)](https://github.com/edrlab/thorium-reader/commit/e7bd5e074ad8e28872796d528b32cdd634697370) __fix:__ Electron app activate and power shutdown (PR [#1045](https://github.com/edrlab/thorium-reader/pull/1045) Fixed [#1038](https://github.com/edrlab/thorium-reader/issues/1038) Follow-up to [#1041](https://github.com/edrlab/thorium-reader/issues/1041))
* [(_)](https://github.com/edrlab/thorium-reader/commit/8de22fd97051754829df2922eddfa7e32b25343d) __fix:__ Mac application quit triggers graceful shutdown / resource cleanup (PR [#1041](https://github.com/edrlab/thorium-reader/pull/1041))
* [(_)](https://github.com/edrlab/thorium-reader/commit/4e2fe146699bc88e39619d8cc35108f778b54dcd) __fix:__ regression from PR [#930](https://github.com/edrlab/thorium-reader/pull/930) regarding HTTPS Readium URL for publication sandboxing (see https://github.com/edrlab/thorium-reader/pull/930#pullrequestreview-407849487 )
* [(_)](https://github.com/edrlab/thorium-reader/commit/49fa1e0bf7ebaacdb63bf9d7a94ec609f9a6a3ea) __fix(TTS):__ playback tweaks for edge cases related to navigation, and fixed fullscreen layout (follow up to PR [#1044](https://github.com/edrlab/thorium-reader/pull/1044))
* [(_)](https://github.com/edrlab/thorium-reader/commit/31e3f6c8738607e11d85045fec86602900551e34) __feat:__ TTS readaloud, also fixes settings save/reset buttons style, also fixes incorrect sepia/night theme in bottom bar (PR [#1044](https://github.com/edrlab/thorium-reader/pull/1044) Fixes [#935](https://github.com/edrlab/thorium-reader/issues/935))
* [(_)](https://github.com/edrlab/thorium-reader/commit/539023da06df11ce494261ca1765d3d6c34201fa) __fix(typo):__ streamer stop() was not called correctly (PR [#1043](https://github.com/edrlab/thorium-reader/pull/1043) Follows PR [#930](https://github.com/edrlab/thorium-reader/pull/930))
* [(_)](https://github.com/edrlab/thorium-reader/commit/9fd7615460c44cd82ef75ba0c2e5a0d0b82a0687) __fix:__ uncomment necessary code for the deletion of stale publication identifiers (PR [#1042](https://github.com/edrlab/thorium-reader/pull/1042) Follows PR [#930](https://github.com/edrlab/thorium-reader/pull/930))
* [(_)](https://github.com/edrlab/thorium-reader/commit/e73c42dad18438a63b424b1e400a512e50cb7d91) __chore(NPM):__ package updates
* [(_)](https://github.com/edrlab/thorium-reader/commit/321c18b97bdee43f3619de085d2a733f5ad6ccc2) __fix(refactor):__ global Redux store persist, per-publication session state, OPDS catalog last column info, tags editor prevent empty text, mismatched reader settings (PR [#930](https://github.com/edrlab/thorium-reader/pull/930) Fixes [#1036](https://github.com/edrlab/thorium-reader/issues/1036) Fixes [#1037](https://github.com/edrlab/thorium-reader/issues/1037) Fixes [#1035](https://github.com/edrlab/thorium-reader/issues/1035) Fixes [#911](https://github.com/edrlab/thorium-reader/issues/911))
* [(_)](https://github.com/edrlab/thorium-reader/commit/3a235fe2966645d7f2328a7f7cffcfa19adbf0ce) __fix:__ Reader display/layout/formatting settings were not synchronized correctly (initial values), and MathJax refresh was triggered unnecessarily
* [(_)](https://github.com/edrlab/thorium-reader/commit/8d194a7d651367b8b9f2931b1381e5b0e14a8697) __feat(dev):__ code scope checker (WebPack resource boundaries for reader / library logic)
* [(_)](https://github.com/edrlab/thorium-reader/commit/223dec9739a5e5ac0b4c26af92848d73bf927b6e) __chore(NPM):__ package updates
* [(_)](https://github.com/edrlab/thorium-reader/commit/8865e6aa77ea57afa00f842bc7938e034fd8e092) __chore(dev):__ Hot Module Reload turned off by default (view state is entirely reloaded)
* [(_)](https://github.com/edrlab/thorium-reader/commit/2c10dd01cabb0e0a7d591d758d1e3e5537e1341d) __fix(UI):__ fullscreen margins (Fixes [#1033](https://github.com/edrlab/thorium-reader/issues/1033))
* [(_)](https://github.com/edrlab/thorium-reader/commit/b6cfbe782f70dac2bbdff3ff6e55b282c05fe412) __chore(dev):__ fixed incorrect R2-xxx-js imports
* [(_)](https://github.com/edrlab/thorium-reader/commit/5a7eb087f36b219be3fea7e41319178fb179ebb5) __fix:__ LCP or OPDS download without Content Type attribute in Link, now fallback to HTTP response headers (content-type/disposition)
* [(_)](https://github.com/edrlab/thorium-reader/commit/85307c10df61f2fd92b6041e01b9720b7f23c21c) __fix:__ audiobooks duration time with iso8601 format, support for float values (PR [#1028](https://github.com/edrlab/thorium-reader/pull/1028) Fixes [#1026](https://github.com/edrlab/thorium-reader/issues/1026))
* [(_)](https://github.com/edrlab/thorium-reader/commit/7531d36d521c79e8e2e0f6196223e379ce8d8836) __chore(dev):__ TravisCI MacOS builds with no notarization (and no signing)
* [(_)](https://github.com/edrlab/thorium-reader/commit/5f6d68eb315feadf8a9cf48e3960a97a4b40f988) __chore(NPM):__ package updates, UUID major semver but no impact, TMP major 0.x.x allows custom temp dir config again
* [(_)](https://github.com/edrlab/thorium-reader/commit/e77c45553b4d0d99730bedbd0ce76e6bbfa283dd) __fix(audiobooks):__ fallback on W3C publication manifest type when mandatory conformsTo is missing (PR [#1025](https://github.com/edrlab/thorium-reader/pull/1025) Fixes [#1023](https://github.com/edrlab/thorium-reader/issues/1023))
* [(_)](https://github.com/edrlab/thorium-reader/commit/802a89949ee035f71bcd7d75c7e60ba50cc1f8db) __chore(NPM):__ minor semver package updates, removal of react-hot-loader (Fixes [#1024](https://github.com/edrlab/thorium-reader/issues/1024))
* [(_)](https://github.com/edrlab/thorium-reader/commit/d127b5747e3e83ba140792ea4a2c7f4c694c5a57) __chore(release):__ version bump for new development sprint

__Developer Notes__:

* The [standard-changelog](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/standard-changelog) utility (`npx standard-changelog --first-release`) somehow only generates a limited number of commits, so we use a one-liner command line / shell script instead:
* `git --no-pager log --decorate=short --pretty=oneline v1.3.0...v1.4.0 | cut -d " " -f 1- | sed -En '/^([0-9a-zA-Z]+)[[:space:]]([^:]+):(.+)$/!p;s//\1 __\2:__\3/p' | sed -En 's/^(.+)$/* \1/p' | sed -En '/PR[[:space:]]*#([0-9]+)/!p;s//PR [#\1](https:\/\/github.com\/edrlab\/thorium-reader\/pull\/\1)/gp' | sed -En '/\(#([0-9]+)/!p;s//(PR [#\1](https:\/\/github.com\/edrlab\/thorium-reader\/pull\/\1)/gp' | sed -En '/(Fixes|See|Fix|Fixed)[[:space:]]*#([0-9]+)/!p;s//\1 [#\2](https:\/\/github.com\/edrlab\/thorium-reader\/issues\/\2)/gp' | sed -En '/^.[[:space:]]([0-9a-zA-Z]+)[[:space:]]/!p;s//* [(_)](https:\/\/github.com\/edrlab\/thorium-reader\/commit\/\1) /p' | sed -En '/[[:space:]]#([0-9]+)/!p;s// [#\1](https:\/\/github.com\/edrlab\/thorium-reader\/issues\/\1)/gp'`
* ...append `| pbcopy` on MacOS to copy the result into the clipboard.
* ...append `| wc -l` to verify that the result actually matches the number of Git commits.
