# Thorium Reader v1.2.0

## Summary

Version `1.2.0` was released on **25 March 2020**.

This release includes the following (notable) new features, improvements and bug fixes:

* Configurable keyboard shortcuts (including new commands, for example "goto toolbar", "boomark", "goto navigation panel"): editor user interface with auto-capture (i.e. automatic detection key events) or fine-grain user selection (i.e. choice of modifier keys + main action key from a list of predefined options), as well as alternative configuration method for advanced users: raw config file (JSON format)
* There is now a keyboard-accessible (tab / shift-tab) hidden link at the beginning of publication documents in order to redirect focus (notably, screen reader cursor) to the currently-linked reading location (for example TOC heading, bookmark destination, etc.)
* Fixed accessibility-related keyboard focus issues: hyperlinks inside publication documents (notably: visual temporary outlining of link target), TOC heading links and bookmark destinations (landing point above the main frame now with clearer label, tested with several screen readers, which do not navigate into the frame's keyboard focus consistently).
* Fix for keyboard-accessible cover images in the bookshelf (local library and remote publication catalogs), and for some UI elements which were not labelled correctly (e.g. the "delete" cross icon in OPDS catalogs)
* Preliminary support for AudioBooks (Packaged Readium Web Pub Manifest format): separation of publication types in the local bookshelf, handling of time bookmarks, display of audio metadata (duration, number of tracks), support for audiobooks without TOC Table Of Contents (instead: audio files in reading order, with "chapter" description label / title), application of ReadiumCSS styling (font size and family, color theme) etc. TODOs: https://github.com/readium/readium-desktop/issues?q=is%3Aissue+is%3Aopen+label%3Aaudiobooks
* Spanish translation (in addition to existing English, French and German)
* Bookmarks list in the navigation panel are now ordered (as per the linear reading progression of the publication)
* Bookmarking now supports text selection (automatically sets the bookmark description / label), and multiple bookmarks per page spread can be created
* In the "goto page" feature (navigation panel), the nearest preceding EPUB pagebreak is shown to provide information about the current reading context
* The bottom interactive "reading progress" bar now correctly handles mouse clicks offset (percentage progression into individual spine items, text and audiobooks)
* Fixed significant performance issues in publication documents, which were due to how Chromium renders HTML (including Readium CSS), and prioritizes paint requests for large documents textures (e.g. GPU 2D/3D accelerated selections/annotations, but also weird edge cases with night and sepia modes)
* OPDS browsing improvments, notably: support for facets (to be continued)
* Fixed bug due to HTTP response logging (there was no safeguard for the error case of offline / network down conditions)
* Various low-level code refactorings, in order to scale architecture for future updates / feature additions
* Fixed memory leak: publication ZIP was not deallocated (filesystem handle freed) when the last reader window closed
* Latest updates available for NPM packages / library dependencies, including Electron version 8 (Chromium version 80)


(previous [v1.1.0 changelog](./CHANGELOG-v1.1.0.md))

## Full Change Log

Git commit diff since `v1.1.0`:
https://github.com/readium/readium-desktop/compare/v1.1.0...v1.2.0

=> **70** GitHub Pull Requests or high-level Git commits.

Here is the complete list of commits, ordered by descending date:
* [(_)](https://github.com/readium/readium-desktop/commit/91047e0c12e4814d806da5c428b54baa750bce5f) __chore(release):__ version bump 1.2.0 [skip ci]
* [(_)](https://github.com/readium/readium-desktop/commit/874ec7c1a0a2b33acb42cb13df0f68f923baf160) __chore(release):__ changelog update
* [(_)](https://github.com/readium/readium-desktop/commit/1051a1e6bd109df95471f35f575765e5f23c059d) __chore(NPM):__ package updates, including Electron 8.2.0 (slightly newer Chromium + bugfixes + feature update)
* [(_)](https://github.com/readium/readium-desktop/commit/8cff266811e967b1b731f058da4e18ecf745795a) __fix(minor):__ code typo, function name (PR [#981](https://github.com/readium/readium-desktop/pull/981)) [skip ci]
* [(_)](https://github.com/readium/readium-desktop/commit/f23409688171cab117797d82e53f9784f67dac1f) __fix(dev):__ devtools context menu now ensures focus on web inspector window (same strategy used in r2-navigator-js for the "inspect element" at x,y coordinates in embedded webview)
* [(_)](https://github.com/readium/readium-desktop/commit/2dd301792d53927959e83984957a58eed0a4d9e4) __chore(NPM):__ package updates (including r2-navigator-js), minor fix to HTML templates for reader and library windows (prompted by WebPack plugin update)
* [(_)](https://github.com/readium/readium-desktop/commit/d2c86af6f5cd3e2b8e6f0321b6f709038194b091) __chore(release):__ changelog update [skip ci]
* [(_)](https://github.com/readium/readium-desktop/commit/51e5fa17dedd00dccf9dd701bc9d3a08e11fda02) __fix(audiobooks):__ the list view was not displaying all publications (grid view did), follow-up to PR [#974](https://github.com/readium/readium-desktop/pull/974)
* [(_)](https://github.com/readium/readium-desktop/commit/a351f38635ce3d425d08a32a72768168133eafbe) __fix(GUI):__ bottom interactive progress bar now correctly handles mouse clicks offset (percentage progression into individual spine items, text and audiobooks)
* [(_)](https://github.com/readium/readium-desktop/commit/39e4c38059dae8c45036f72855c490b739cadeab) __chore(release):__ added draft version 1.2.0 changelog [skip ci]
* [(_)](https://github.com/readium/readium-desktop/commit/0687ddfcd2ad4ee2b988204c1f66cf2d7c6c5b6f) __chore(NPM):__ package updates, including latest r2-shared-js
* [(_)](https://github.com/readium/readium-desktop/commit/15d05387816c7eb2019d9b6451ce55b31a6fa2d9) __feat(audiobooks):__ separation of "reading" vs. "listening" in local bookshelf display (PR [#974](https://github.com/readium/readium-desktop/pull/974) Fixes [#941](https://github.com/readium/readium-desktop/issues/941))
* [(_)](https://github.com/readium/readium-desktop/commit/292874f1fa4f77a4ce477d49f087ddbd1a68043c) __feat(audiobooks):__ publication info modal popup dialog now displays duration and number of tracks (PR [#973](https://github.com/readium/readium-desktop/pull/973) Fixes [#940](https://github.com/readium/readium-desktop/issues/940))
* [(_)](https://github.com/readium/readium-desktop/commit/8de631b1ea2387a8387a4d610770202b00edc87a) __fix(bookmarks):__ ordered list, better add/remove logic, name derived from audio timestamp / percent progression, or selected text (PR [#977](https://github.com/readium/readium-desktop/pull/977))
* [(_)](https://github.com/readium/readium-desktop/commit/665406a090d35895c95d0e8e4ca545cc73c64ca7) __hotfix(typo):__ fixed linting error from previous commit (async/await)
* [(_)](https://github.com/readium/readium-desktop/commit/a09bd2c8c80a81d0286827c474da5c4fef00dea0) __hotfix(regression):__ introduction of strict linting for async/await promises broke runtime due to waiting for browser windows to finish loading, see https://github.com/readium/readium-desktop/pull/975#issuecomment-601385534
* [(_)](https://github.com/readium/readium-desktop/commit/77e39a81f31ab4c2069cf5400118eadc1f9a7c6e) __chore(NPM):__ updated package, reset lockfile
* [(_)](https://github.com/readium/readium-desktop/commit/4ed1ad281e9219e41e7cc1eb5b93feaa90e77c72) __fix(audiobooks):__ remove unnecessary ReadiumCSS UI (PR [#976](https://github.com/readium/readium-desktop/pull/976) Fixes [#944](https://github.com/readium/readium-desktop/issues/944))
* [(_)](https://github.com/readium/readium-desktop/commit/ac9595581b6c3878d5f8aaabf96cf8eb9351c9a9) __chore(dev):__ reinstate `no-floating-promises` in `tslint.json`, remove `qs` and `query-string` NPM packages (PR [#975](https://github.com/readium/readium-desktop/pull/975) Fixes [#698](https://github.com/readium/readium-desktop/issues/698) Fixes [#554](https://github.com/readium/readium-desktop/issues/554))
* [(_)](https://github.com/readium/readium-desktop/commit/2b1b9e32042f6fddd5cfc60bf29a0915cfb3fe35) __chore(npm):__ package dependency updates, mainly file-loader (WebPack) which now defaults to MD4 hash (see https://github.com/webpack-contrib/file-loader/blob/master/CHANGELOG.md#600-2020-03-17 )
* [(_)](https://github.com/readium/readium-desktop/commit/4bdab070f4d7c7f4b87aee9faff7bb80130e1678) __chore(NPM):__ [skip ci] minor version update in secondary package.json (Yargs)
* [(_)](https://github.com/readium/readium-desktop/commit/be5f91a2f15927b2788eb7f951b38f7c12d8bb68) __feat(l10n):__ Spanish translation (PR [#971](https://github.com/readium/readium-desktop/pull/971) + PR [#957](https://github.com/readium/readium-desktop/pull/957))
* [(_)](https://github.com/readium/readium-desktop/commit/79fdfdcbbc2e2f2deb64d9c79be0e29c1ab026c9) __feat(a11y):__ nearest preceding EPUB pagebreak shown next to "goto page" input field (PR [#965](https://github.com/readium/readium-desktop/pull/965))
* [(_)](https://github.com/readium/readium-desktop/commit/3b4f0c4843f3d12e41d3e01b80d0a31298a77ff5) __chore(NPM):__ package updates, including r2-navigator-js with fixes for epub pagebreak and text selection / current reading location
* [(_)](https://github.com/readium/readium-desktop/commit/efd7af89ae1cb407d7f949eab0150d344e7b4656) __fix(audiobooks):__ no TOC => fallback on readingOrder with titles (Fixes [#949](https://github.com/readium/readium-desktop/issues/949))
* [(_)](https://github.com/readium/readium-desktop/commit/82fe7f446df741c6776f937528e8bdbf42aafdf2) __chore(NPM):__ package updates, including important r2-navigator-js fixes and improvements (a11y, audiobooks, performance)
* [(_)](https://github.com/readium/readium-desktop/commit/5ff455171863123d66256ecb594ea53069e1e9ad) __hotfix(a11y):__ Page Up / Down reversal (see comment https://github.com/readium/readium-desktop/issues/155#issuecomment-598058091 ) [skip ci]
* [(_)](https://github.com/readium/readium-desktop/commit/f944d774992e4783a4d1634bd05ffce36c82c777) __fix(a11y):__ publication image cover link with clearer announcement (title + authors label) (Fixes [#968](https://github.com/readium/readium-desktop/issues/968))
* [(_)](https://github.com/readium/readium-desktop/commit/4f0ac79de3a574a6a7911cfde0078936c50e4d6d) __chore(NPM):__ minor package updates, including Electron
* [(_)](https://github.com/readium/readium-desktop/commit/3096451ae62f8e7fdbe404aabd220078e2623289) __fix(a11y):__ keyboard shortcuts editor was not resetting its state correctly (event capture), reader window initialization needed state sync at launch, keyboard shortcuts were not reloaded dynamically (required window content refresh), toast notifications in keyboard editor were too aggressive / annoying, renamed shortcuts labels / IDs (consistency), added reader window close shortcut, added alternative shortcuts to left/right arrow keys (which are reserved in several screen readers)
* [(_)](https://github.com/readium/readium-desktop/commit/c1cdbbe2d402c21453e1ceb7fd6311969ae9874d) __chore(NPM):__ package updates, including improved R2 navigator (keyboard and screen reader support)
* [(_)](https://github.com/readium/readium-desktop/commit/3c80141c2e4318b048e76355811cb460927292f6) __fix(a11y):__ bookmark links in navigation panel now behave exactly like TOC links, in that the menu is closed and the focus is redirected to the content frame (caveat: screen readers still read from the beginning of the HTML file)
* [(_)](https://github.com/readium/readium-desktop/commit/4fc20b45d520da0e0b63ea07663d9c956e414f7f) __fix(a11y):__ NVDA screen reader was struggling with anchor links in the reader window (top toolbar region). CTRL-T keyboard shortcut focus-move is now announced correctly.
* [(_)](https://github.com/readium/readium-desktop/commit/b6ef8cc757792df36a5890f0103bfe0a48e2be9a) __fix(a11y):__ window title was not updated by Helmet in DOM head (lib now replaced with document.title setter)consistently set title in LibraryLayout (e.g. search or tag keyword), removed unecessary intermediary DOM divs, eliminated unused 'title' state in reader, updated NPM packages
* [(_)](https://github.com/readium/readium-desktop/commit/5b63fdcd13689afa8dfa716b13f24b4e35223815) __fix(lint):__ extraneous spaces
* [(_)](https://github.com/readium/readium-desktop/commit/63148ce2c2f537e506637ddfe9b1771e47298e4b) __hotfix(a11y):__ Follow-up to PR [#958](https://github.com/readium/readium-desktop/pull/958) fix for keyboard handler in editor
* [(_)](https://github.com/readium/readium-desktop/commit/afa682796765c9c3877fd2496b272e8ef0362767) __fix(a11y):__ toolbar and main content quick-access keyboard shortcut landmark labels, see https://github.com/readium/readium-desktop/issues/155#issuecomment-593904332
* [(_)](https://github.com/readium/readium-desktop/commit/2ac8e5b702b2c00f366a2b98ddc9b6dc186c370c) __chore:__ replaced hard-coded Thorium string with APP_NAME compile-time var
* [(_)](https://github.com/readium/readium-desktop/commit/e8d702b141da2e6caa9b73cb43e20c0bf77edb73) __fix(a11y):__ added missing title label for delete cross SVG icon on OPDS feed in catalog view (library window)
* [(_)](https://github.com/readium/readium-desktop/commit/9db3c94263e768ac61397727b398df6793ed0486) __feat(a11y):__ configurable keyboard shortcuts, also fixes duplicate cover image tab stop, updates NPM packages (PR [#958](https://github.com/readium/readium-desktop/pull/958) Fixes [#155](https://github.com/readium/readium-desktop/issues/155) Fixes [#838](https://github.com/readium/readium-desktop/issues/838))
* [(_)](https://github.com/readium/readium-desktop/commit/a9e5a63530cf6277e65504456e457f0c23e1509e) __chore(NPM):__ package updates, notably UUID breaking API change (PR [#963](https://github.com/readium/readium-desktop/pull/963))
* [(_)](https://github.com/readium/readium-desktop/commit/7ed4e1eade6e0a0f68e9445e50736db54270148a) __hotfix(ui/l10n):__ inconsistent usage of ':' colon separator, with prefix/suffix space (note that current convention is US/UK, future fix will address localization issues)
* [(_)](https://github.com/readium/readium-desktop/commit/966186660f8b34eaa5201c7f702f9fd0359f7f40) __hotfix(a11y):__ title attribute on `i` element was unnecessarily hiding text content (language code + human-readable name)
* [(_)](https://github.com/readium/readium-desktop/commit/b857b7b5b58e2f6a55231410e6e6091b48bebb98) __hotfix(ui):__ comma ',' suffix was added at end of publishers / contributors list (now is separator *between* list items)
* [(_)](https://github.com/readium/readium-desktop/commit/36fbca41c4307b4a0703164cd9873bc7364d47ea) __hotfix:__ regression in PR [#513](https://github.com/readium/readium-desktop/pull/513) where R2 navigator was using the localhost/127.0.0.1 URL instead of the special domain / custom protocol for isolating publication origins
* [(_)](https://github.com/readium/readium-desktop/commit/ae3f87509f561bbda89ba99dbb735438ac1e6f89) __hotfix(CI):__ Octokit/rest API breaking change for Travis/AppVeyor automated build updates to GitHub (see https://github.com/octokit/rest.js/commit/c1d6c6a37ef4967753515c435f79bcedfcba29bf )
* [(_)](https://github.com/readium/readium-desktop/commit/c6bfb6840a89e26726645a452908ee563e056f0e) __chore(NPM):__ package update for PouchDB LevelDB adapter (minor), locked tslint to v5 (deprecated anyway, must migrate to jslint with different default linting rules), major Octokit/rest package update (should be fine, will check build log for GitHub release uploads)
* [(_)](https://github.com/readium/readium-desktop/commit/2507dd5a6096432c262532d0919e4371ff06287b) __chore(NPM):__ minor package updates, and includes r2-shared-js which fixes a decodeURIComponent bug
* [(_)](https://github.com/readium/readium-desktop/commit/31d9ed0583311a43574994da53cadee8789f42eb) __hotfix:__ download queue was growing indefinitely, download totalSize could be unknown (missing HTTP header content-length) resulting in NaN progress value
* [(_)](https://github.com/readium/readium-desktop/commit/6718734481374bbed8ce3c3a83ac3ad5514a5631) __hotfix:__ LCP regression due to downloader .part file extension deducted from URL and breaking EPUB vs. AudioBook detection
* [(_)](https://github.com/readium/readium-desktop/commit/bdb190e7f9cb96d77668d5696f54fbf400c0e5cb) __chore(l10n):__ cleanup pass on locales resources (removed unused translated string), using the tooling npm run i18n-sort, i18n-scan, i18n-check, and i18n-typed
* [(_)](https://github.com/readium/readium-desktop/commit/738d908d51cc103d0b845a33fb75a247227f6fd9) __fix:__ packaged application launch had blank window (Fixes [#948](https://github.com/readium/readium-desktop/issues/948))
* [(_)](https://github.com/readium/readium-desktop/commit/411e381f9d9f18e92ed1fb31ac77ae0b5e5629e7) __feat(audio):__ first pass / iteration, support for audiobooks (reading location save/restore, bookmarks, ReadiumCSS theming, but missing metadata display, library category, etc.) (PR [#938](https://github.com/readium/readium-desktop/pull/938))
* [(_)](https://github.com/readium/readium-desktop/commit/526c5587094dd3949dc2e0b7159e189331f75311) __chore(dev):__ NPM package updates (most minor), includes Electron v8 (requires recompiled LCP lib), includes latest R2 components which add support for navigator publication session (audiobooks in separate PR) (PR [#937](https://github.com/readium/readium-desktop/pull/937))
* [(_)](https://github.com/readium/readium-desktop/commit/eb3aef2c8f2bb73da49b2de6e9526f3b496d43fa) __dev:__ removed unused streamer file (PR [#928](https://github.com/readium/readium-desktop/pull/928))
* [(_)](https://github.com/readium/readium-desktop/commit/99159a9ef0813bc340d5cd54204b79fc726921de) __dev:__ refactor LCP action/reducer for publication file lock (PR [#929](https://github.com/readium/readium-desktop/pull/929))
* [(_)](https://github.com/readium/readium-desktop/commit/73adad0262c27be3ba64626897271a5105b35e58) __fix(ui):__ the "about" modal popup box had a dialog overlay with infinite spinner (PR [#932](https://github.com/readium/readium-desktop/pull/932) Fixes [#931](https://github.com/readium/readium-desktop/issues/931))
* [(_)](https://github.com/readium/readium-desktop/commit/d957cad2f9804423d055690c81b2e9a9f5565b9d) __chore(dev):__ API code shared between Electron main and renderer processes (PR [#925](https://github.com/readium/readium-desktop/pull/925) Fixes [#924](https://github.com/readium/readium-desktop/issues/924))
* [(_)](https://github.com/readium/readium-desktop/commit/8b83bb22171cf8dc26597b0df25ee8515998b9bf) __fix:__ refactor - split reader and library renderer process bundles (PR [#916](https://github.com/readium/readium-desktop/pull/916) Fixes [#921](https://github.com/readium/readium-desktop/issues/921))
* [(_)](https://github.com/readium/readium-desktop/commit/8311af1f9980981b0a317d5829ca2d10b218876a) __feat(OPDS):__ facets and additional metadata, UX/UI will be improved in future commit, for example breadcrumb (PR [#881](https://github.com/readium/readium-desktop/pull/881) Fixes [#851](https://github.com/readium/readium-desktop/issues/851) Fixes [#613](https://github.com/readium/readium-desktop/issues/613))
* [(_)](https://github.com/readium/readium-desktop/commit/cefd19c9f6f40a0126ed5009bf08fdf0f8606076) __chore(dev):__ async/await translator setLocale with i18next promise (PR [#907](https://github.com/readium/readium-desktop/pull/907))
* [(_)](https://github.com/readium/readium-desktop/commit/4bbf830e0ac7199bc2d21d289f1337b01e031f83) __fix:__ HTTP response logging did not have safeguards for error case (Fixes [#889](https://github.com/readium/readium-desktop/issues/889))
* [(_)](https://github.com/readium/readium-desktop/commit/4326a65b6c04b49fbb20764eae4dac2ba8b1218a) __chore(dev):__ disable unused code - "net" and "update" Redux state + Sagas (PR [#912](https://github.com/readium/readium-desktop/pull/912))
* [(_)](https://github.com/readium/readium-desktop/commit/8b570a31683208868ae8aeb5af81db960be3dd10) __fix(l10n):__ UI header locale was not refreshed when switching language, library and reader app launch now centralized (needs further work, first pass) (PR [#903](https://github.com/readium/readium-desktop/pull/903) Fixes [#882](https://github.com/readium/readium-desktop/issues/882) Fixes [#897](https://github.com/readium/readium-desktop/issues/897))
* [(_)](https://github.com/readium/readium-desktop/commit/aacfe6bbd33db5623a01cfb2939713b6015c8790) __chore(NPM):__ package dependencies updates
* [(_)](https://github.com/readium/readium-desktop/commit/b150d697ba03946a21e09f46b44660a2e6cc9bf2) __chore(dev):__ version bump 1.1.2-alpha.1 for CI builds
* [(_)](https://github.com/readium/readium-desktop/commit/e74195f49ca5c27ef692a31c56c415a07d63b1ab) __chore(doc):__ removed the beta statement in the info text [skip ci]
* [(_)](https://github.com/readium/readium-desktop/commit/789aad849b20847d0cb4dbd1c9ad457445461214) __chore(release):__ 1.1.1 hotfix version bump [skip ci]
* [(_)](https://github.com/readium/readium-desktop/commit/37dba9a5b98e14b553bf08e96340394a5c35be1a) __fix:__ publication ZIP is deallocated (filesystem handle freed) when last reader window closes (PR [#885](https://github.com/readium/readium-desktop/pull/885) Fixes [#884](https://github.com/readium/readium-desktop/issues/884))
* [(_)](https://github.com/readium/readium-desktop/commit/1a3fea4939f5453326129dc37f2660f4636f66c5) __chore(ci):__ version bump 1.1.1-alpha.1

__Developer Notes__:

* The [standard-changelog](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/standard-changelog) utility (`npx standard-changelog --first-release`) somehow only generates a limited number of commits, so we use a one-liner command line / shell script instead:
* `git --no-pager log --decorate=short --pretty=oneline v1.1.0...v1.2.0 | cut -d " " -f 1- | sed -En '/^([0-9a-zA-Z]+)[[:space:]]([^:]+):(.+)$/!p;s//\1 __\2:__\3/p' | sed -En 's/^(.+)$/* \1/p' | sed -En '/PR[[:space:]]*#([0-9]+)/!p;s//PR [#\1](https:\/\/github.com\/readium\/readium-desktop\/pull\/\1)/gp' | sed -En '/\(#([0-9]+)/!p;s//(PR [#\1](https:\/\/github.com\/readium\/readium-desktop\/pull\/\1)/gp' | sed -En '/(Fixes|See|Fix|Fixed)[[:space:]]*#([0-9]+)/!p;s//\1 [#\2](https:\/\/github.com\/readium\/readium-desktop\/issues\/\2)/gp' | sed -En '/^.[[:space:]]([0-9a-zA-Z]+)[[:space:]]/!p;s//* [(_)](https:\/\/github.com\/readium\/readium-desktop\/commit\/\1) /p' | sed -En '/[[:space:]]#([0-9]+)/!p;s// [#\1](https:\/\/github.com\/readium\/readium-desktop\/issues\/\1)/gp'`
* ...append `| pbcopy` on MacOS to copy the result into the clipboard.
* ...append `| wc -l` to verify that the result actually matches the number of Git commits.
